(function(){var Interval,Majster,Notify,app,isArray,isFunction,isString,isUndefined;isUndefined=function(x){return null==x},isFunction=function(x){return x&&"[object Function]"==={}.toString.call(x)},isArray=function(x){return x&&"[object Array]"==={}.toString.call(x)},isString=function(x){return x&&"[object String]"==={}.toString.call(x)},Majster=function(){function Majster(){}var attributes,map,parameters,widgets;return widgets={},attributes={},Majster.prototype.controller=function(widgetId,arg1,arg2){var callback,params;if(callback=isFunction(arg1)?arg1:arg2,params=isArray(arg1)?arg1:[],isUndefined(widgetId))throw"first parameter (widgetId) is not defined";if(!isFunction(callback))throw"callback is not a function. widgetId "+widgetId;if(!isUndefined(widgets[widgetId]))throw"widgetId "+widgetId+" already defined";return widgets[widgetId]={callback:callback,params:params,name:widgetId,type:"widget"},this},Majster.prototype.task=function(name,arg1,arg2){var callback,params;if(widgets["majster:task:"+name])throw"task is already defined: "+name;if(isString(arg1)&&(params=[arg1]),isArray(arg1)&&(params=arg1),isFunction(arg1)&&(params=[]),isFunction(arg1)&&(callback=arg1),isFunction(arg2)&&(callback=arg2),isUndefined(callback))throw"task not defined";return widgets["majster:task:"+name]={callback:callback,params:params,name:name,type:"task"},this},Majster.prototype.set=function(name,callback){if("$data"===name||"$element"===name)throw"Name restricted for framework "+name;return attributes[name]=callback,this},Majster.prototype.scan=function($element){var $child,child,j,len,ref;for(isUndefined($element.attr("widget"))||map($element,$element.attr("widget")),ref=$element.find("[widget]"),j=0,len=ref.length;j<len;j++)child=ref[j],$child=$(child),map($child,$child.attr("widget"));return this},Majster.prototype.run=function(taskName){var i,widget;if(isUndefined(taskName))for(i in widgets)widget=widgets[i],"task"===widget.type&&this.run(widget.name);else{if(isUndefined(widgets["majster:task:"+taskName]))throw"Task not defined "+taskName;map($(document),"majster:task:"+taskName)}return this},parameters=function($element,$attr){var attr,j,len,param,params;for(params=[],j=0,len=$attr.length;j<len;j++)attr=$attr[j],param=function(){switch(attr){case"$element":return $element;case"$data":return $element.data();default:if(isUndefined(attributes[attr]))throw"Attribute "+attr+" not found for widget";return attributes[attr]}}(),params.push(param);return params},map=function($element,widgetId){var callback,widget;if(widget=widgets[widgetId],isUndefined(widget))throw"widget "+widgetId+" not found";return callback=widget.callback,callback.apply({},parameters($element,widget.params))},Majster}(),app=new Majster,window.app=app,$(function(){return window.app.scan($(document)),window.app.run()}),app.controller("auto-scan",["$element"],function($component){var MutationObserver,observer;return MutationObserver=window.MutationObserver||window.WebKitMutationObserver,observer=new MutationObserver(function(mutations){var j,len,mutation,node,results;for(results=[],j=0,len=mutations.length;j<len;j++)mutation=mutations[j],results.push(function(){var k,len1,ref,results1;for(ref=mutation.addedNodes,results1=[],k=0,len1=ref.length;k<len1;k++)node=ref[k],results1.push(app.scan($(node)));return results1}());return results}),observer.observe($component.get(0),{attributes:!0,childList:!0,subtree:!0})}),app.set("$delay",{call:function(time,callback){return setTimeout(callback,time)}}),Interval=function(){function Interval(){}var intervals;return intervals={},Interval.prototype.start=function(name){if(null==intervals[name])throw"Interval not defined: "+name+". Can't start";if(null!=intervals[name].interval)throw"Interval is running "+name+". Can't start again";return intervals[name].interval=setInterval(intervals[name].callback,intervals[name].time),this},Interval.prototype.set=function(name,time,callback){if(null!=intervals[name]&&null!=intervals[name].interval)throw"Interval "+name+" is running. Stop first to change";return intervals[name]={callback:callback,time:time,interval:null},this},Interval.prototype.stop=function(name){if(null==intervals[name])throw"Interval not defined: "+name+" . Can't stop.";if(null==intervals[name].interval)throw"Interval is not started "+name;return clearInterval(intervals[name].interval),intervals[name].interval=null,this},Interval}(),app.set("$interval",new Interval),Notify=function(){function Notify(){}var listeners;return listeners={},Notify.prototype.listen=function(name,callback){return isUndefined(listeners[name])&&(listeners[name]={callbacks:[]}),listeners[name].callbacks.push(callback),this},Notify.prototype.send=function(name,params){var callback,j,len,ref;if(!isUndefined(listeners[name]))for(ref=listeners[name].callbacks,j=0,len=ref.length;j<len;j++)(callback=ref[j])(params);return this},Notify}(),app.set("$notify",new Notify)}).call(this);
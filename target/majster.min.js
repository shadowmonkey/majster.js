var js={isString:function(val){return"string"===$.type(val)},isUndefined:function(val){return void 0===val},isDefined:function(val){return!js.isUndefined(val)},isFunction:function(val){return"function"===$.type(val)},isNotFunction:function(val){return!js.isFunction(val)},generateUUID:function(){return Math.random().toString(36).substr(2,9)}};window.app=(new function(){var widgets={},mappings={},$params={},$tasks=[],initFunction=function(){},processParams=function($element,$widgetParams){var params=[];return $.each($widgetParams,function(i,param){switch(param){case"$element":params.push($element);break;case"$data":params.push($element.data());break;default:if(js.isUndefined($params[param]))throw"Attribute "+param+" not found for widget";params.push($params[param])}}),params},mapping=function($element,id){var widget=widgets[id],callback=widget.callback,params=processParams($element,widget.params),uid=js.generateUUID();$element.attr("widget-init",!0),$element.attr("widget-uid",uid),callback.apply({},params),mappings[id+uid]={uid:uid,widgetId:id,element:$element,callback:callback}},remove=function($element){var widgetId=$element.attr("widget"),uid=$element.attr("widget-uid"),key=widgetId+uid;if(!js.isDefined(mappings[key]))throw new"Element is not under framework control";mappings[key].callback=function(){}},invokeWidgets=function($element){js.isDefined($element.attr("widget"))&&mapping($element,$element.attr("widget")),$element.find("[widget]").each(function(){var $this=$(this);if(js.isUndefined($this.attr("widget-init"))){var widgetId=$this.attr("widget");mapping($this,widgetId)}})},invokeTasks=function(){$.each($tasks,function(i,$task){var params=[];$.each($task.params,function(i,param){if(js.isUndefined($params[param]))throw"Attribute "+param+" not found for widget";params.push($params[param])});var callback=$task.callback;callback.apply({},params),$task.invoke=callback})},ready=function(){$(document).ready(function(){initFunction(),invokeWidgets($(document)),invokeTasks()})},public={setUp:function(callback){return initFunction=callback,public},set:function(name,callback){if("$data"===name||"$element"===name)throw"Name restricted for framework: "+$name;return $params[name]=callback,public},define:function(name,callback){return callback($params[name]),public},controller:function(widgetId,params,callback){if(js.isUndefined(widgetId))throw"widgetId is not defined";if(js.isNotFunction(callback))throw"class is undefined or is not function";if(js.isDefined(widgets[widgetId]))throw"widgetId is already defined: "+widgetId;return widgets[widgetId]={callback:callback,params:params},public},task:function(params,callback){return $tasks.push({params:params,callback:callback}),public},scan:invokeWidgets,remove:remove};return ready(),public}).set("$notify",new function(){var listeners={},public={listen:function(name,callback){return js.isUndefined(listeners[name])&&(listeners[name]={callbacks:[]}),listeners[name].callbacks.push(callback),public},send:function(name,params){return js.isDefined(listeners[name])&&$.each(listeners[name].callbacks,function(i,callback){callback(params)}),public}};return public}).set("$delay",{call:function(time,callback){setTimeout(callback,time)}}).set("$interval",new function(){var intervals={},start=function(name){if(!js.isDefined(intervals[name]))throw"Interval not defined: "+name+". Can't start.";intervals[name].interval=setInterval(intervals[name].callback,intervals[name].time)};return{set:function(name,time,callback){return intervals[name]={callback:callback,time:time,interval:void 0},{start:function(){start(name)}}},start:start,stop:function(name){if(!js.isDefined(intervals[name]))throw"Interval not defined: "+name+". Can't stop.";clearInterval(intervals[name].interval)}}}).set("$websocket",new function(){var websockets={},start=function(name){var definition=websockets[name];if(js.isUndefined(definition))throw"Can't start websocket: "+name+". No definition found";if(definition.started)throw"Can't start websocket: "+name+". Already started";var websocket=new WebSocket(definition.url,definition.protocols);js.isFunction(definition.open)&&(websockets[name].started=start,websocket.onopen=definition.open),js.isFunction(definition.message)&&(websocket.onmessage=definition.message),js.isFunction(definition.close)&&(websocket.onclose=function(){websockets[name].started=!1,definition.close()}),websockets[name].websocket=websocket};return{define:function(name,url,protocols){if(!("WebSocket"in window))throw"WebSocket is not supported by browser";if(js.isDefined(websockets[name]))throw"Websocket "+name+" is already defined";websockets[name]={url:url,protocols:protocols,started:!1};var action={on:function(name,callback){switch(name){case"open":action.open(callback);break;case"message":action.message(callback);break;case"close":action.message(callback);break;case"error":action.error(callback);break;default:throw"Action "+name+" not found on $websocket"}return action},open:function(callback){return websockets[name].open=callback,action},message:function(callback){return websockets[name].message=callback,action},close:function(callback){return websockets[name].close=callback,action},error:function(callback){return websockets[name].error=callback,action},start:function(){start(name)}};return action},start:start,send:function(name,object){var websocket=websockets[name];if(js.isUndefined(websocket))throw"Can't send message. Websocket: "+name+" not found";if(!websocket.started)throw"Can't send message. Websocket: "+name+" is closed";websockets[name].websocket.send(object)},close:function(name){var websocket=websockets[name];if(js.isUndefined(websocket))throw"Can't close websocket. Websocket: "+name+" not found";if(!websocket.started)throw"Can't close websocket. Websocket: "+name+" is't started";websockets[name].websocket.close()},get:function(name){var websocket=websockets[name];if(js.isUndefined(websocket))throw"Can't close websocket. Websocket: "+name+" not found";return websocket}}}).set("$form",function(){var rules={};return{bind:function($element){var saved={},validation={},callbacks={valid:function(){},invalid:function(){}},trigger=function(){var valid=!0;$.each(validation,function(selector,val){val||(valid=!1)}),valid?callbacks.valid():callbacks.invalid()},handleSuccess=function($target,arg){js.isDefined(arg.success)&&arg.success($target),js.isDefined(arg.errorClass)&&$target.removeClass(arg.errorClass)},handleFailure=function($target,arg,obj){js.isDefined(arg.errorLabel)&&js.isDefined(obj.message)&&(_.isFunction(arg.errorLabel)?arg.errorLabel($target).text(obj.message):$element.find(arg.errorLabel).text(obj.message)),js.isDefined(arg.errorClass)&&$target.addClass(arg.errorClass),js.isDefined(arg.error)&&arg.error($target)},apply=function($target,name,arg,selector){js.isDefined(arg[name])&&$target.on(name,function(){$.each(arg[name],function(i,obj){var result=rules[obj.rule]($target,obj);result?(validation[selector]=!0,handleSuccess($target,arg)):(validation[selector]=!1,!js.isUndefined(obj.silent)&&obj.silent||handleFailure($target,arg,obj)),trigger()})})},public={apply:function(selector,arg){var formElement=$element.find(selector);if(!formElement)throw"Can't find element with selector "+selector;return validation[selector]=!1,js.isDefined(arg.extend)&&arg.extend(formElement),apply(formElement,"click",arg,selector),apply(formElement,"blur",arg,selector),apply(formElement,"change",arg,selector),apply(formElement,"focus",arg,selector),apply(formElement,"hover",arg,selector),apply(formElement,"keydown",arg,selector),apply(formElement,"keyup",arg,selector),apply(formElement,"mouseleave",arg,selector),apply(formElement,"change",arg,selector),saved[selector]={obj:formElement,arg:arg},public},clean:function(selector){var data=saved[selector];handleSuccess(data.obj,data.arg)},ifValid:function(callback){return callbacks.valid=callback,public},ifInvalid:function(callback){return callbacks.invalid=callback,public}};return public},define:function(name,callback){if(!js.isUndefined(rules[name]))throw"Rule is already defined";rules[name]=callback}}}()).controller("auto-scan",["$element"],function($component){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver,observer=new MutationObserver(function(mutations){$.each(mutations,function(index,mutation){$.each(mutation.addedNodes,function(i,element){$element=$(element),app.scan($element)}),$.each(mutation.removedNodes,function(i,element){$element=$(element),js.isDefined($element.attr("widget"))&&app.remove($element),$element.find("[widget]").each(function(){app.remove($(this))})})})});observer.observe($component.get(0),{attributes:!0,childList:!0,subtree:!0})});var app=window.app;